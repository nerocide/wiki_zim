Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2017-07-19T16:34:40+02:00

====== Mediawiki ======
Created mercredi 19 juillet 2017

ssh root@192.168.56.101

===== Info =====
Sur le wiki oxya
https://wiki.oxya.com/index.php/Special:Version
Personnalisation du wikieditor
http://192.168.56.101/wiki/index.php/Personnaliser_l%27%C3%A9diteur_de_Mediawiki_(WikiEditor)

===== Installation =====

==== Procédure ====
Installer la version 1.29.0 minimum avec les extension core de base et 

=== Centos 7 ===

{{{code: lang="sh" linenumbers="True"
yum -y install mariadb-server httpd wget git
yum -y install epel-release
yum -y update
chkconfig mariadb on
chkconfig httpd on
rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
yum -y install php56w php56w-opcache php56w-mbstring php56w-mysql php56w-xml
service httpd start
service mysqld start
wget https://releases.wikimedia.org/mediawiki/1.29/mediawiki-1.29.0.tar.gz
tar xzvf mediawiki-1.29.0.tar.gz
mv mediawiki-1.29.0 /var/www/html/wiki

}}}



{{{code: lang="sh" linenumbers="True"
Alias /wiki2 /var/www/html/wiki2

<Directory /var/www/html/wiki2/>
	Options +FollowSymLinks
	AllowOverride All
	<IfVersion >= 2.3>
		Require all granted
	</IfVersion>
	<IfVersion < 2.3>
		order allow,deny
		allow from all
	</IfVersion>
</Directory>

# some directories must be protected
<Directory /var/www/html/wiki2/config>
	Options -FollowSymLinks
	AllowOverride None
    <IfModule mod_php7.c>
        php_admin_flag engine off
    </IfModule>
    <IfModule mod_php5.c>
        php_admin_flag engine off
    </IfModule>
</Directory>
<Directory /var/www/html/wiki2/images>
	Options -FollowSymLinks
	AllowOverride None
    <IfModule mod_php7.c>
        php_admin_flag engine off
    </IfModule>
    <IfModule mod_php5.c>
        php_admin_flag engine off
    </IfModule>
</Directory>
<Directory /var/www/html/wiki2/upload>
	Options -FollowSymLinks
	AllowOverride None
    <IfModule mod_php7.c>
        php_admin_flag engine off
    </IfModule>
    <IfModule mod_php5.c>
        php_admin_flag engine off
    </IfModule>
</Directory>
}}}


===== Extensions =====

==== Visual editor ====
https://www.mediawiki.org/wiki/Extension:VisualEditor
git submodule update --init

=== conf LocalSettings.conf ===
{{{code: lang="php" linenumbers="True"
wfLoadExtension( 'VisualEditor' );

// Enable by default for everybody
$wgDefaultUserOptions['visualeditor-enable'] = 1;

// Optional: Set VisualEditor as the default for anonymous users
// otherwise they will have to switch to VE
// $wgDefaultUserOptions['visualeditor-editor'] = "visualeditor";

// Don't allow users to disable it
$wgHiddenPrefs[] = 'visualeditor-enable';

// OPTIONAL: Enable VisualEditor's experimental code features
$wgDefaultUserOptions['visualeditor-enable-experimental'] = 1;

$wgVirtualRestConfig['modules']['parsoid'] = array(
		// URL to the Parsoid instance
		// Use port 8142 if you use the Debian package
		'url' => 'http://localhost:8000',
		// Parsoid "domain", see below (optional)
		'domain' => 'localhost',
		// Parsoid "prefix", see below (optional)
		'prefix' => 'localhost'
);

#$wgVisualEditorParsoidURL = 'http://localhost:8000';
$wgSessionsInObjectCache = true;
$wgVirtualRestConfig['modules']['parsoid']['forwardCookies'] = true;
}}}


==== PARSOID ====
{{{code: lang="sh" linenumbers="True"
yum -y install nodejs npm
git parsoid
mv pardoid /opt
npm install
systemctl daemon-reload
}}}

voir => https://www.centos.org/forums/viewtopic.php?f=47&t=53223&start=10

=== fichier de conf ===
{{{code: lang="sh" linenumbers="True"
worker_heartbeat_timeout: 300000
logging:
	level: trace
services:
  - module: lib/index.js
	entrypoint: apiServiceWorker
	conf:
		mwApis:
	  -
		  uri: 'http://192.168.56.102/wiki/api.php'
		debug: true
		linting: true
		linterSendAPI: false
}}}


==== PdfHandler ====
Doc https://www.mediawiki.org/wiki/Extension:PdfHandler

=== Prérequis ===
{{{code: lang="sh" linenumbers="True"
yum install -y ghostscript xpdf ImageMagick
}}}


=== Installation ===
{{{code: lang="sh" linenumbers="True"
wget https://extdist.wmflabs.org/dist/extensions/PdfHandler-REL1_29-6766ffc.tar.gz
tar xzvf PdfHandler-REL1_29-6766ffc.tar.gz
mv PdfHandler /var/www/html/wiki/extensions/
chown -R apache:apache /var/www/html/wiki/extensions/PdfHandler
}}}


=== LocalSettings.php ===
$wfLoadExtension( 'PdfHandler' );

==== PdfBook ====
https://www.mediawiki.org/wiki/Extension:PdfBook

=== Prérequis ===
{{{code: lang="sh" linenumbers="True"
yum install -y htmldoc
}}}


wget https://code.organicdesign.co.nz/extensions/zipball/master
unzip master
mv MediaWiki/PdfBook [[/var/www/html/wiki/extensions/]]
chown -R apache:apache /var/www/html/wiki/extensions/*

=== LocalSettings.php ===
wfLoadExtension( 'PdfBook' );

==== PdfWriter ====
https://www.mediawiki.org/wiki/Extension:PDF_Writer

=== installation ===
{{{code: lang="sh" linenumbers="True"
easy_install mwlib && rehash && easy_install mwlib.rl
}}}


==== ConsoleOutput ====
https://www.mediawiki.org/wiki/Extension:ConsoleOutput
cd extensions
git clone http://git.funtoo.org/MediaWiki-ConsoleOutput [[ConsoleOutput]]
require_once( "$IP/extensions/ConsoleOutput/ConsoleOutput.php" );

==== SyntaxHighLight ====
https://www.mediawiki.org/wiki/Extension:SyntaxHighlight
wget https://www.mediawiki.org/wiki/Special:ExtensionDistributor/SyntaxHighlight_GeSHi
wfLoadExtension( 'SyntaxHighlight_GeSHi' );

[[https://www.mediawiki.org/wiki/Extension:VisualEditor|https://www.mediawiki.org/wiki/Extension:]]MSupload
[[https://www.mediawiki.org/wiki/Extension:VisualEditor|https://www.mediawiki.org/wiki/Extension:]]UploadWizard

Aide sur les extensions de gestion de droits:
https://www.mediawiki.org/wiki/Category:Page_specific_user_rights_extensions

==== SimpleSecurity ====
https://www.mediawiki.org/wiki/Extension:SimpleSecurity (https://extdist.wmflabs.org/dist/extensions/SimpleSecurity-REL1_29-e3b77d0.tar.gz)

==== Collection ====
https://www.mediawiki.org/wiki/Extension:Collection
require_once "$IP/extensions/Collection/Collection.php";

==== SphinxSearch ====
https://www.mediawiki.org/wiki/Extension:SphinxSearch

https://www.mediawiki.org/wiki/Extension:Approved_Revs
https://www.mediawiki.org/wiki/Extension:FlaggedRevs


