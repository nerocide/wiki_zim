Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2017-07-19T16:34:40+02:00

====== Mediawiki ======
Created mercredi 19 juillet 2017

ssh root@192.168.56.101

===== Info =====
Sur le wiki oxya
https://wiki.oxya.com/index.php/Special:Version
Personnalisation du wikieditor
http://192.168.56.101/wiki/index.php/Personnaliser_l%27%C3%A9diteur_de_Mediawiki_(WikiEditor)

===== Installation =====

==== Proc√©dure ====
Installer la version 1.29.0 minimum avec les extension core de base et 

==== Centos 7 ====

{{{code: lang="sh" linenumbers="True"
yum -y install mariadb-server httpd wget git
yum -y install epel-release
yum -y update
chkconfig mariadb on
chkconfig httpd on
rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
yum -y install php56w php56w-opcache php56w-mbstring php56w-mysql php56w-xml
service httpd start
service mysqld start
wget https://releases.wikimedia.org/mediawiki/1.29/mediawiki-1.29.0.tar.gz
tar xzvf mediawiki-1.29.0.tar.gz
mv mediawiki-1.29.0 /var/www/html/wiki

}}}



{{{code: lang="sh" linenumbers="True"
Alias /wiki2 /var/www/html/wiki2

<Directory /var/www/html/wiki2/>
	Options +FollowSymLinks
	AllowOverride All
	<IfVersion >= 2.3>
		Require all granted
	</IfVersion>
	<IfVersion < 2.3>
		order allow,deny
		allow from all
	</IfVersion>
</Directory>

# some directories must be protected
<Directory /var/www/html/wiki2/config>
	Options -FollowSymLinks
	AllowOverride None
    <IfModule mod_php7.c>
        php_admin_flag engine off
    </IfModule>
    <IfModule mod_php5.c>
        php_admin_flag engine off
    </IfModule>
</Directory>
<Directory /var/www/html/wiki2/images>
	Options -FollowSymLinks
	AllowOverride None
    <IfModule mod_php7.c>
        php_admin_flag engine off
    </IfModule>
    <IfModule mod_php5.c>
        php_admin_flag engine off
    </IfModule>
</Directory>
<Directory /var/www/html/wiki2/upload>
	Options -FollowSymLinks
	AllowOverride None
    <IfModule mod_php7.c>
        php_admin_flag engine off
    </IfModule>
    <IfModule mod_php5.c>
        php_admin_flag engine off
    </IfModule>
</Directory>
}}}



===== Extension =====

===== Visual eidtor =====
https://www.mediawiki.org/wiki/Extension:VisualEditor
git submodule update --init


=== conf LocalSettings.conf ===
wfLoadExtension( 'VisualEditor' );

// Enable by default for everybody
$wgDefaultUserOptions['visualeditor-enable'] = 1;

// Optional: Set VisualEditor as the default for anonymous users
// otherwise they will have to switch to VE
// $wgDefaultUserOptions['visualeditor-editor'] = "visualeditor";

// Don't allow users to disable it
$wgHiddenPrefs[] = 'visualeditor-enable';

// OPTIONAL: Enable VisualEditor's experimental code features
$wgDefaultUserOptions['visualeditor-enable-experimental'] = 1;

$wgVirtualRestConfig['modules']['parsoid'] = array(
		// URL to the Parsoid instance
		// Use port 8142 if you use the Debian package
		'url' => 'http://localhost:8000',
		// Parsoid "domain", see below (optional)
		'domain' => 'localhost',
		// Parsoid "prefix", see below (optional)
		'prefix' => 'localhost'
);

#$wgVisualEditorParsoidURL = 'http://localhost:8000';
$wgSessionsInObjectCache = true;
$wgVirtualRestConfig['modules']['parsoid']['forwardCookies'] = true;


==== PARSOID ====
yum -y install nodejs npm
git parsoid
mv pardoid /opt
npm install
systemctl daemon-reload
voir => https://www.centos.org/forums/viewtopic.php?f=47&t=53223&start=10

worker_heartbeat_timeout: 300000
logging:
	level: trace
services:
  - module: lib/index.js
	entrypoint: apiServiceWorker
	conf:
		mwApis:
	  -
		  uri: 'http://192.168.56.102/wiki/api.php'
		debug: true
		linting: true
		linterSendAPI: false




[[https://www.mediawiki.org/wiki/Extension:VisualEditor|https://www.mediawiki.org/wiki/Extension:]]MSupload
[[https://www.mediawiki.org/wiki/Extension:VisualEditor|https://www.mediawiki.org/wiki/Extension:]]UploadWizard
