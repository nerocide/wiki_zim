Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2016-10-06T16:55:05+02:00

====== REAR - backup solution ======

===== Test avec frbslux36 =====

==== Description du scénario ====
Remonter ux36 from scratch à l'aide de rear, on crée un container VM identique en CPU/RAM & disques.
La machine cible portera le même nom (FQDN)

==== Modifier la configuration de REAR sur le client source (si besoin) ====
''cat /etc/rear/local.conf''
OUTPUT=ISO
BACKUP=NBU

De cette manière l'iso bootable intégrera le client NetBackup

==== Générer l'iso bootable ====
''rear mkrescue''
Par défaut l'iso se trouve danc /var/lib/rear/output

==== Copier l'iso sur le datastore concerné ====
''scp rear-frbslux36.iso frbslvm08:/vmfs/volumes/frbslvm08_localdatastore1/iso''

==== Monter l'iso et booter ====
Modifier les paramètres de la vm et lui affecter l'iso et booter
Se connecter comme root (sans password)

==== Lancer la restauration ====
''rear recover''
Faire suivant sur les questions posées pour accepter les choix par défaut, nom du client (identique à la source), date du backup à restaurer (par défaut le dernier dispo).
Au niveau de NBU un job se lance, attendre qu'il se termine.
Au niveau de rear attendre la fin du recover.

==== Rebooter ====
''reboot''

Vérifier le système après reboot, tout doit être présent et opérationnel.

==== Déterminer si le système a besoin d'une nouvelle image? ====
Lancer :
''rear checklayout''
Cette commande retourne 0 si le système n'a pas besoin d'une nouvelle image
Il est possible d'automatiser la tâche ainsi:
'''
# cat /etc/cron.d/rear
 30 1 * * * root /usr/sbin/rear checklayout || /usr/sbin/rear mkrescue
'''


==== Ressources ====
Site officiel http://relax-and-recover.org/
Documentation officielle http://relax-and-recover.org/documentation/

==== Poursuivre avec REAR chez MANE ====
* créer un espace de stockage NFS (upload ISO)
* créer un alias DNS
* configurer les clients (rear sur les machines)
* lancer les commandes ou crontab
* upload des images
